{% extends sitebase.html%}
{% block head%}
<link rel="stylesheet" type="text/css" href="/static/emperor/support_files/css/emperor.css">
<link rel="stylesheet" type="text/css" href="/static/emperor/support_files/vendor/css/jquery-ui.min.css">
<link rel="stylesheet" type="text/css" href="/static/emperor/support_files/vendor/css/slick.grid.min.css">
<link rel="stylesheet" type="text/css" href="/static/emperor/support_files/vendor/css/spectrum.min.css">
<link rel="stylesheet" type="text/css" href="/static/emperor/support_files/vendor/css/chosen.min.css">

<style>
  div.emperor-space{
    position: fixed;
    height: 50%;
    width: 70%;
    margin: 0;
  }
</style>

<script type="text/javascript" src="/static/emperor/support_files/vendor/js/require-2.1.22.min.js"></script>
<script type="text/javascript">
  requirejs.config({
    'baseUrl': '/static/emperor/support_files/',

    // the left side is the module name, and the right side is the path
    // relative to the baseUrl attribute, do NOT include the .js extension
    'paths': {
      /* jQuery */
      'jquery': './vendor/js/jquery-2.1.4.min',
      'jqueryui': './vendor/js/jquery-ui.min',
      'jquery_drag': './vendor/js/jquery.event.drag-2.2.min',

      /* jQuery plugins */
      'chosen': './vendor/js/chosen.jquery.min',
      'spectrum': './vendor/js/spectrum.min',

      /* other libraries */
      'underscore': './vendor/js/underscore-min',
      'chroma': './vendor/js/chroma.min',

      /* THREE.js and plugins */
      'three': './vendor/js/three.min',
      'orbitcontrols': './vendor/js/three.js-plugins/OrbitControls',

      /* SlickGrid */
      'slickcore': './vendor/js/slick.core.min',
      'slickgrid': './vendor/js/slick.grid.min',
      'slickformatters': './vendor/js/slick.editors.min',
      'slickeditors': './vendor/js/slick.formatters.min',

      /* Emperor's objects */
      'model': './js/model',
      'view': './js/view',
      'controller': './js/controller',
      'draw': './js/draw',
      'scene3d': './js/sceneplotview3d',
      'viewcontroller': './js/view-controller',
      'colorviewcontroller': './js/color-view-controller',
      'visibilitycontroller': './js/visibility-controller',
      'color-editor': './js/color-editor',
    },
    /*
       Libraries that are not AMD compatible need shim to declare their
       dependencies.
     */
    'shim': {
      'jquery_drag': {
        'deps': ['jquery', 'jqueryui']
      },
      'chosen': {
        'deps': ['jquery'],
        'exports': 'jQuery.fn.chosen'
      },
      'orbitcontrols': {
        'deps': ['three']
      },
    'slickcore': ['jqueryui'],
    'slickgrid': ['slickcore', 'jquery_drag', 'slickformatters',
                  'slickeditors']
    }
  });

  requirejs(
    ["jquery", "model", "controller"],
    function($, model, EmperorController) {
      var DecompositionModel = model.DecompositionModel;

      $("<div id='plots' class='emperor-space'></div>").appendTo(document.body);
      var div = $('#plots');

      var ids = {% raw coords_ids %};
      var coords = {% raw coords %};
      var pct_var = {% raw pct_var %};
      var md_headers = {% raw md_headers%};
      var metadata = {% raw  metadata %};

      var dm, ec;

      function init() {
        // Initialize the DecompositionModel
        dm = new DecompositionModel(name, ids, coords, pct_var,
                                    md_headers, metadata);
        // Initialize the EmperorController
        ec = new EmperorController(dm, 'plots');
      }

      $(window).resize(function() {
        ec.resize(window.innerWidth * 0.5, window.innerHeight * 0.7);
      });

      function animate() {
        requestAnimationFrame(animate);
        ec.render();
      }


      $(document).ready(function(){
        init();
        animate();
        var sv = ec.sceneViews[0];


        //HIDE EDITING USING EMPEROR
        $(function(){
          var barcodes = getParameterByName('barcodes');
          ec.colorController.$header.hide();
          ec._$tabsList.hide();

          //CHANGE BG TO WHITE AND AXES TO BLACK
          sv.drawAxesLabelsWithColor('#000000');
          sv.drawAxesWithColor('#000000');
          sv.renderer.setClearColor('#FFFFFF');

          //TRIPLE SIZE OF BARCODE POINTS
        for(i=0;i<barcodes.length;i++) {
          var sample =sv.scene.getObjectByName(barcodes[i]).split(",");
          sample.scale.x = 3;
          sample.scale.y = 3;
          sample.scale.z = 3;
        }

        //RECOLOR TO HIGHLIGHT POINTS
          s = sv.decViews.scatter;
          s.setGroupColor(0x000000, s.decomp.plottable);
          s.setGroupColor(0xFF0000, s.decomp.getPlottableByIDs(barcodes));
        });
      });
  }); // END REQUIRE.JS block
</script>
{% end %}
{% block content %}
<div id="emperor-wrapper" style="width:100%">
  THIS IS SOME TEXT
  <div id='plots' class='emperor-space'></div>
</div>
{% end %}
